import os
import time
import re
from datetime import  datetime, timezone, timedelta

from funcaouteis import Veropcao
from lerarquivos import ApagarLinhasDuplicadas, PegarIp, DominioIp, Seq1, Seq2, LimparEmail

print("===========================")
print("|           |              ")
print("|           |              O mesmo criador de")
print("|           |              Naner: O jogo do bicho")
print("|           |              ")
print("|           |              ")
print("|           |              ")
print("|_________  |_________")
print("===========================")
print("\n")
print("===========================")
print("|       NANER PENTEST      |")
print("===========================")
print("\n")
# for url in $(cat arquivo); do wget -q $url;done


data_e_hora_atuais = datetime.now()
data_e_hora_em_texto = data_e_hora_atuais.strftime("%d/%m/%Y")
data_e_hora_em_texto = data_e_hora_atuais.strftime("%d/%m/%Y %H:%M")
diferenca = timedelta(hours=-3)
fuso_horario = timezone(diferenca)
data_e_hora_sao_paulo = data_e_hora_atuais.astimezone(fuso_horario)
data_e_hora_sao_paulo_em_texto = data_e_hora_sao_paulo.strftime("%d/%m/%Y %H:%M")

print(data_e_hora_sao_paulo_em_texto)
os.system("echo '" + str(data_e_hora_sao_paulo_em_texto) + "' >> resultados/hora_inicial")


def Opcao(opcao,dominio):
	if int(opcao) == 1:
		#resposta_validar_dominio = input("Digite 1 para mudar o dominio, o dominio atual é: " + str(dominio))
		#if int(resposta_validar_dominio) == 1 :
		#	dominio = input("Digite um dominio do escopo ")
		os.system("urlcrazy -r " + str(dominio)  +  " > resultados/urls"+str(dominio))
		os.system("head resultados/urls"+str(dominio)+ " -n 100")
		print("1")
		
	if int(opcao) == 2:
		print("Ligando o tor...")
		os.system("sudo service start tor")
		print('Ligado')
		print('Utilizando o karma')

			#arquivo = input("Digite o nome do arquivo que você deseja procurar com emails")
		os.system("karma target -o resultados/emails_hacking"+str(dominio) + " > resultados/emails_karma"+str(dominio))
			#os.system("karma search -o " + str(arquivo) + " > senha_karma")
		os.system("cat resultados/emails_karma"+str(dominio))
		#os.system("cat resultados/senha_karma"+str(dominio))
		print("2")
		
	if int(opcao) == 3:
		os.system("theHarvester -d"+ str(dominio) + " -l 100 -b google -f resultados/resultado"+str(dominio)+".html")
		#os.system("firefox resultado"+str(dominio)+".html")
		print("3")
	if int(opcao) == 4:
		print("Sem registro SPF = Vulnerável a falsificação de e-mail (Mail Spoofing)" + 
"v= SPFL include:servidorpermitido.com ?all = suscetível(neutro)"+
"v = spfl include:servidorpermitido.com ~all = suscetível(é tratado como suspeito*)"+
"v = spfl include:servidorpermitido.com -all = Configuração Recomendada\n \n \n")
		os.system("host -t txt " + str(dominio) +" > resultados/SPF"+str(dominio))
		os.system("cat resultados/SPF"+str(dominio))
		print("Entre nesse site para fazer o ataque: http://emkei.cz/")
		print("4")
	if int(opcao) == 5:
		'''
		ext = input("extensão: ")
		parte2 = '" | grep "'+str(ext)+'" | cut -d "=" -f2 | egrep -v   "google" | egrep -v "site" | sed "s/...$//" > arquivos'
		os.system('sudo lynx --dump "https://google.com/search?&q=site:'+str(dominio)+'+ext:'+str(ext) + str(parte2))
		os.system("for url in $(cat arquivos); do wget -q $url;done")
		os.system("exiftoll *."+str(ext))
		'''
		contador = 0
		os.system("rm -f resultados/emails_hacking"+str(dominio))

		while(contador < 20):
			os.system("echo 'página" +str(int(contador/10)) + "' " )
			os.system('sudo lynx --dump "https://google.com/search?&q=intext:' + str(dominio) +'&start=' + str(contador) + '" | grep "@"'+str(dominio) +'>> resultados/emails_hacking'+str(dominio))
			contador = contador + 10
			time.sleep(10)

		LimparEmail(dominio)



		os.system("cat 'resultados/emails_hacking"+ str(dominio)+"'")
		print("5")
	if int(opcao) == 6:
		os.system("./parsinghtml.sh " + str(dominio))
		os.system("echo 'Você agora tem duas listas, as dos dominios e as dos ips dos hosts, com o nome de' ")
		print("resultados/" + str(dominio)+".txt  aqui para ver os dominios")
		print("resultados/"+str(dominio)+"2.txt aqui para ver os ips")
		ApagarLinhasDuplicadas(dominio)


		ver_ip = "12"
		#input("Digite 1 para ver os dominios\n Digite 2 para ver os ips \n Digite 12 para ver os dois" )
		if ver_ip == "1":
			os.system("cat resultados/" + str(dominio) +" ")
		if ver_ip == "2":
			os.system("cat resultados/" + str(dominio) +"2.txt")
		if ver_ip == "12":
			os.system("cat resultados/" + str(dominio) +".txt")
			os.system("cat resultados/" + str(dominio) +"2.txt")
		print("6")
	if int(opcao) == 7:
		os.system('host -t A '+   str(dominio) + ' | cut -d " " -f4 > resultados/ip_do_dominio'+str(dominio))
		ip = PegarIp(dominio)
		
		os.system("whois " + str(ip)+ " > resultados/whois"+str(dominio))
		os.system("whois " + str(ip) + " | egrep 'inetnum|aut-num' | cut -d ':' -f2 > resultados/range_ips"+str(dominio))
		print("7")
	if int(opcao) == 8:
		os.system('for server in $(host -t ns '  + str(dominio) +  " | cut -d ' ' -f4); do host -l -a "  + str(dominio) +" $server;done")
		print("8")
	if int(opcao) == 9:
		os.system('for palavra in $(cat lista_possiveis_subdominios);do host $palavra.'+str(dominio) + ';done | grep -v "NXDOMAIN" > resultados/subdominios'+str(dominio))
		print("9")
	if int(opcao) == 10:
		os.system('cat resultados/range_ips'+str(dominio)+' | cut -d "." -f3,2,1  > resultados/dominio_mesmo_ip'+str(dominio))
		dominio_ip = DominioIp(dominio)
		os.system('cat resultados/range_ips'+str(dominio)+' | cut -d "." -f4 | cut -d "-" -f1 > resultados/seq1'+str(dominio))
		seq1 = Seq1(dominio)

		os.system('cat resultados/range_ips'+str(dominio)+' | cut -d "." -f7 > resultados/seq2'+str(dominio))
		os.system('cat resultados/range_ips'+str(dominio)+' | cut -d "." -f7 > resultados/seq2'+str(dominio))
		seq2 = Seq2(dominio)
		contador = int(seq1)

		os.system("rm -f resultados/script_dns_reverse"+str(dominio))
		while (contador < int(seq2)):

			os.system("host -t ptr " + str(dominio_ip) + "."+ str(contador) + " >> resultados/script_dns_reverse"+str(dominio))

			contador = contador + 1
		os.system("cat resultados/script_dns_reverse"+str(dominio))
		print("10")
	if int(opcao) == 11:
		dominio_ip = DominioIp(dominio)
		seq1 = Seq1(dominio)
		seq2 = Seq2(dominio)


		os.system("nmap -v -sn "+ str(dominio_ip)+ "." + str(seq1) + "-" + str(seq2) + " -oG resultados/ativos"+str(dominio)+".txt")
		
		os.system("grep 'Up' resultados/ativos"+str(dominio)+".txt"+" | cut -d ' ' -f 2 > resultados/hosts"+str(dominio))
		os.system("sudo nmap -sSV -p 80 --open -Pn -iL resultados/hosts" + str(dominio)+ " -oG web"+str(dominio) + ".txt")
		print("11")

	if int(opcao) == 1000:
		seqinicial = int(input("Digite onde começa"))
		seqfinal = int(input("Digite onde termina"))

		os.system("for ip in $(seq "+ str(seqinicial) + " " + str(seqfinal) + "); do arping -c 1 192.168.1.$ip;done | grep '60 bytes' ")


				


		


	

	if int(opcao) == 100:
		comando = input("Digite o comando shell\n")
		os.system(comando)
	
	
	return dominio
		
		
		
		

	
    		

opcao = 0
dominio = input("Digite um dominio do escopo: ")
seq1 = 0
seq2 = 0
dependencias = input("Amigo, você deseja instalar as dependências???? (Digite: S)\n")
if dependencias == "S":
	os.system("sudo apt install tor proxychains")
	print("Digite: service tor start \n para ligar o proxy")
	print("vá em: nano /etc/proxychains.conf\n para fazer algumas configurações")
	print("dentro do arquivo coloque no final")
	print("socks5 127.0.0.1 9050")
	print("dynamic_chain no lugar de strict")
	print("Instalando agora o theHarvester\n")
	os.system("sudo apt install theHarvester")
	print("Instalando o lynx")

	os.system("sudo apt install lynx   ")
	print("Instale manualmente o karma https://github.com/jdiazmx/karma")
	

while(opcao != 88888):
	print("Digite a opção que você deseja escolher e 88888 para sair-- ")
	print("1- URLCRAZY")
	print("2- Procurando por leaks na dark web")
	print("3- theHarvester")
	print("4- SPF")
	print("5- metadados")
	print("6- parsinghtml")
	print("7- whois")
	print("8- zona_transferência")
	print("9- bruteforce dns")
	print("10- pesquisa reversa dns")
	print("11- nmap buscar ativos e verificar a porta 80")

	print("555- AUTOMAÇÃO")

	print("100- execute comandos shells")
	print("1000- arp- pentest interno")

	print("88888- Sair")
	opcao = input()
	try:
		opcao = int(opcao)
		if opcao == 555:
			lista = [1,3,4,5,2,7,8,10,11,9]
			for a in lista:
				dominio = Opcao(a, dominio)

			data_e_hora_atuais = datetime.now()
			data_e_hora_em_texto = data_e_hora_atuais.strftime("%d/%m/%Y")
			data_e_hora_em_texto = data_e_hora_atuais.strftime("%d/%m/%Y %H:%M")
			diferenca = timedelta(hours=-3)
			fuso_horario = timezone(diferenca)
			data_e_hora_sao_paulo = data_e_hora_atuais.astimezone(fuso_horario)
			data_e_hora_sao_paulo_em_texto = data_e_hora_sao_paulo.strftime("%d/%m/%Y %H:%M")

			print(data_e_hora_sao_paulo_em_texto)
			os.system("echo '"+str(data_e_hora_sao_paulo_em_texto)+ "' >> resultados/hora_final")

		else:
			dominio = Opcao(opcao,dominio)
	except:
		print(opcao)
		opcao =  int(input())
		Veropcao(opcao,dominio)

print("FIM\n Por que a neve é branca?\n")
print("A neve esqueceu a sua cor...")